---
phase: 04.1-technical-pivot-bus-migration-to-go
plan: 01
type: execute
depends_on: []
files_modified: [bus/go/go.mod, bus/go/go.sum, bus/go/Makefile, bus/go/cmd/orion-bus/main.go, bus/go/pkg/contracts/.gitkeep]
---

<objective>
Set up Go project structure with dependencies and code generation pipeline.

Purpose: Establish foundation for Go bus implementation with proper tooling
Output: Go module with dependencies, Makefile for code generation, initial project structure
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04.1-technical-pivot-bus-migration-to-go/04.1-RESEARCH.md
@bus/contracts/event.schema.json
@bus/contracts/incident.schema.json
@bus/contracts/decision.schema.json
@bus/python/orion_bus/bus.py

**Tech Stack Available**:
- Python 3.12 event bus (current implementation)
- Redis 7 (Alpine) for Redis Streams
- JSON Schema contracts (8 schemas defined)
- pytest test framework

**Established Patterns**:
- Contract-first design with JSON Schema validation
- Fail-fast validation at boundaries
- Redis Streams consumer groups

**Constraining Decisions**:
- Phase 4: N3 autonomy with approval system operational
- CLAUDE.md: Mixed Python/Go stack - Go for reliability and performance
- ARCHITECTURE.md: Contract validation is mandatory at all boundaries
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Go module with dependencies</name>
  <files>bus/go/go.mod, bus/go/go.sum</files>
  <action>
    Create Go module at bus/go/ with module path `github.com/yourusername/orion/bus/go`.

    Initialize with: `go mod init github.com/yourusername/orion/bus/go`

    Add dependencies:
    - `github.com/redis/go-redis/v9` (Redis Streams client - official, mature, 58 Context7 examples)
    - `github.com/kaptinlin/jsonschema` (JSON Schema Draft 2020-12 validation)
    - `github.com/google/uuid` (UUID generation for message IDs)
    - `github.com/stretchr/testify` (testing assertions)

    Run `go mod tidy` to populate go.sum.

    DO NOT use go-redis/v8 or older - v9 is current stable. DO NOT use santhosh-tekuri/jsonschema - kaptinlin has better Draft 2020-12 support per research.
  </action>
  <verify>go mod verify succeeds, go.mod contains all 4 dependencies with v9+ for go-redis</verify>
  <done>Go module initialized with correct dependencies, go.sum populated</done>
</task>

<task type="auto">
  <name>Task 2: Create project structure and entry point</name>
  <files>bus/go/cmd/orion-bus/main.go, bus/go/internal/.gitkeep, bus/go/pkg/contracts/.gitkeep, bus/go/README.md</files>
  <action>
    Create standard Go project layout following ORION conventions:

    ```
    bus/go/
    ├── cmd/orion-bus/main.go      # Service entry point
    ├── internal/                  # Private packages
    │   ├── bus/                   # EventBus implementation (next plan)
    │   ├── validator/             # JSON Schema validation (Plan 03)
    │   └── shutdown/              # Graceful shutdown (next plan)
    ├── pkg/contracts/             # Generated Go structs (Plan 03)
    └── README.md                  # Module documentation
    ```

    main.go should:
    - Parse command-line flags (redis-addr, log-level)
    - Set up graceful shutdown with signal.NotifyContext (Go 1.16+ pattern)
    - Initialize logger
    - Print "ORION Bus (Go) - Not yet implemented" and wait for SIGTERM
    - Exit cleanly on shutdown

    README.md should follow ORION module README standards:
    - Module: orion-bus (Go)
    - Phase: 4.1 (In Progress)
    - Purpose: High-performance Redis Streams event bus with contract validation
    - Language: Go 1.22+
    - Inputs: Messages from publishers
    - Outputs: Validated messages to Redis Streams
    - Invariants: Contract validation mandatory, fail-fast on invalid messages
    - Failure Modes: Redis connection loss (reconnect), invalid message (reject)

    Use .gitkeep files to preserve empty directories in git.
  </action>
  <verify>go run cmd/orion-bus/main.go starts, logs message, responds to Ctrl+C gracefully</verify>
  <done>Project structure created, main.go builds and runs, README.md complete</done>
</task>

<task type="auto">
  <name>Task 3: Create Makefile for code generation pipeline</name>
  <files>bus/go/Makefile</files>
  <action>
    Create Makefile with targets for code generation and testing.

    Targets:
    - `generate`: Generate Go structs from JSON Schema files in ../contracts/
      - Use `omissis/go-jsonschema` tool (install if missing with `go install`)
      - Generate structs in pkg/contracts/ directory
      - One struct file per schema (event.go, incident.go, decision.go, etc.)
      - Add JSON tags for marshaling
      - Run `go fmt` on generated files

    - `test`: Run all tests with coverage
      - `go test ./... -v -race -coverprofile=coverage.out`
      - Display coverage report

    - `build`: Build orion-bus binary
      - `go build -o bin/orion-bus cmd/orion-bus/main.go`

    - `clean`: Remove generated files and binaries
      - `rm -rf pkg/contracts/*.go bin/`

    - `help`: Display available targets

    DO NOT run code generation yet (Plan 03 will implement that). Just create the Makefile structure.

    Add comment explaining code generation will be implemented in Plan 03 after JSON Schema validation is ready.
  </action>
  <verify>make help displays targets, make build compiles main.go successfully</verify>
  <done>Makefile created with all targets, build target works</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go mod verify` passes
- [ ] `make build` compiles without errors
- [ ] `./bin/orion-bus` starts and responds to signals
- [ ] Project structure matches standard Go layout
- [ ] README.md follows ORION module standards
</verification>

<success_criteria>

- Go module initialized with correct dependencies (go-redis/v9, kaptinlin/jsonschema, uuid, testify)
- Standard Go project layout created (cmd/, internal/, pkg/)
- Entry point (main.go) builds and runs with graceful shutdown
- Makefile defines code generation pipeline (implementation in Plan 03)
- README.md documents module purpose and invariants
- No errors or warnings from go toolchain
  </success_criteria>

<output>
After completion, create `.planning/phases/04.1-technical-pivot-bus-migration-to-go/04.1-01-SUMMARY.md`:

# Phase 4.1 Plan 01: Go Project Setup Summary

**Go module initialized with dependencies and project structure established**

## Accomplishments

- Go module created at `bus/go/` with 4 key dependencies
- Standard Go project layout (cmd/, internal/, pkg/)
- Entry point with graceful shutdown pattern
- Makefile for code generation and testing
- Module README.md following ORION standards

## Files Created/Modified

- `bus/go/go.mod` - Go module definition
- `bus/go/go.sum` - Dependency checksums
- `bus/go/cmd/orion-bus/main.go` - Service entry point
- `bus/go/Makefile` - Build and generation targets
- `bus/go/README.md` - Module documentation
- Project structure directories

## Decisions Made

- Using go-redis/v9 (official client, mature, 58 Context7 examples)
- Using kaptinlin/jsonschema for Draft 2020-12 support (Dec 2025 release)
- Standard Go project layout following community conventions
- signal.NotifyContext for graceful shutdown (Go 1.16+ pattern)

## Issues Encountered

None

## Next Step

Ready for 04.1-02-PLAN.md (Core Bus Implementation)
</output>
