---
phase: 06-edge-integration
plan: 01
type: execute
depends_on: []
files_modified: [bus/contracts/edge.command.schema.json, bus/contracts/edge.telemetry.schema.json, bus/contracts/edge.health.schema.json]
---

<objective>
Create JSON Schema contracts for edge device communication following ORION contract-first design.

Purpose: Define the data contracts between orion-core (Brain) and orion-edge (Pi 4 robot) before any implementation.
Output: Three versioned JSON Schema contracts for commands, telemetry, and health.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/06-edge-integration/06-CONTEXT.md
@.planning/phases/06-edge-integration/06-RESEARCH.md
@.planning/codebase/ARCHITECTURE.md
@bus/contracts/event.schema.json
@bus/contracts/decision.schema.json

**Prior Decisions:**
- Phase 4.1: Go bus operational with contract validation
- Phase 5: AI Council integrated with Brain as optional validation layer
- All ORION contracts use version "1.0", require UUIDs, ISO 8601 timestamps, source field

**From CONTEXT.md:**
- Pi 16GB (Brain) sends high-level goals, Pi 4 (Edge) handles kinematics
- Dead Man's Switch: edge must detect network loss and enter safe state
- Commands: move, stop, calibrate, status
- Telemetry: position, battery, temperature, health

**From RESEARCH.md:**
- MQTT topic structure: orion/edge/{device-id}/cmd/* and telemetry/*
- QoS: 0 for telemetry, 1-2 for commands
- Health heartbeats critical for Dead Man's Switch
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create edge.command.schema.json contract</name>
  <files>bus/contracts/edge.command.schema.json</files>
  <action>
Create JSON Schema for edge device commands following ORION contract patterns.

Required fields (match existing contract conventions):
- version: const "1.0"
- command_id: string, uuid format
- timestamp: string, date-time format
- source: string (e.g., "orion-brain")

Command-specific fields:
- command_type: enum ["MOVE", "STOP", "CALIBRATE", "STATUS"]
- device_id: string (edge device identifier)
- parameters: object (command-specific params, optional)
  - For MOVE: direction (forward/backward/left/right), speed (0.0-1.0), duration_ms
  - For STOP: reason (string, optional)
  - For CALIBRATE: calibration_type (string)
  - For STATUS: (no params needed)
- priority: enum ["NORMAL", "HIGH", "EMERGENCY"] (default: NORMAL)
- expires_at: string, date-time format (optional, for time-limited commands)

Set additionalProperties: false (ORION invariant).
Use $schema draft-07 like other contracts.
  </action>
  <verify>python -c "import json; json.load(open('bus/contracts/edge.command.schema.json'))" succeeds (valid JSON)</verify>
  <done>edge.command.schema.json exists with all required fields, follows ORION contract conventions</done>
</task>

<task type="auto">
  <name>Task 2: Create edge.telemetry.schema.json contract</name>
  <files>bus/contracts/edge.telemetry.schema.json</files>
  <action>
Create JSON Schema for edge device telemetry following ORION contract patterns.

Required fields:
- version: const "1.0"
- telemetry_id: string, uuid format
- timestamp: string, date-time format
- source: string (e.g., "orion-edge-hexapod-1")
- device_id: string

Telemetry-specific fields:
- telemetry_type: enum ["POSITION", "BATTERY", "TEMPERATURE", "SERVO_STATUS", "NETWORK"]
- value: object (telemetry-specific data)
  - For POSITION: x, y, z (numbers), heading (degrees)
  - For BATTERY: level (0-100), voltage (number), charging (boolean)
  - For TEMPERATURE: cpu_temp, motor_temp (numbers, Celsius)
  - For SERVO_STATUS: servo_id (0-17), angle (number), load (0-1)
  - For NETWORK: connected (boolean), latency_ms (number), last_heartbeat (date-time)

Set additionalProperties: false.
  </action>
  <verify>python -c "import json; json.load(open('bus/contracts/edge.telemetry.schema.json'))" succeeds</verify>
  <done>edge.telemetry.schema.json exists with all telemetry types defined</done>
</task>

<task type="auto">
  <name>Task 3: Create edge.health.schema.json contract for Dead Man's Switch</name>
  <files>bus/contracts/edge.health.schema.json</files>
  <action>
Create JSON Schema for edge health/heartbeat messages critical for Dead Man's Switch.

Required fields:
- version: const "1.0"
- health_id: string, uuid format
- timestamp: string, date-time format
- source: string (e.g., "orion-edge-hexapod-1")
- device_id: string

Health-specific fields:
- state: enum ["RUNNING", "IDLE", "SAFE_MODE", "ERROR", "OFFLINE"]
- uptime_seconds: integer, minimum 0
- last_command_id: string, uuid format (optional, last executed command)
- connection_status: object
  - mqtt_connected: boolean
  - redis_connected: boolean
  - last_brain_contact: string, date-time format
- safety_state: object
  - dead_man_switch_active: boolean
  - watchdog_remaining_ms: integer (milliseconds until safety trigger)
  - in_safe_position: boolean (true if "Sit & Freeze" position)
- errors: array of strings (current error conditions, may be empty)

This contract is critical - the Brain monitors these messages to detect edge failures.
Set additionalProperties: false.
  </action>
  <verify>python -c "import json; json.load(open('bus/contracts/edge.health.schema.json'))" succeeds</verify>
  <done>edge.health.schema.json exists with Dead Man's Switch fields for safety monitoring</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All three schema files are valid JSON
- [ ] All schemas have version "1.0", *_id (uuid), timestamp (date-time), source fields
- [ ] All schemas have additionalProperties: false
- [ ] edge.command.schema.json has command_type enum with MOVE/STOP/CALIBRATE/STATUS
- [ ] edge.telemetry.schema.json has telemetry_type enum with all 5 types
- [ ] edge.health.schema.json has Dead Man's Switch fields (dead_man_switch_active, watchdog_remaining_ms)
- [ ] Go bus validator can load new schemas: `cd bus/go && go test ./internal/validator/...`
</verification>

<success_criteria>
- All three edge contracts created following ORION conventions
- Contracts integrate with existing Go bus validator
- Dead Man's Switch monitoring fields present in health schema
- All tests pass (Go bus validator loads new schemas)
</success_criteria>

<output>
After completion, create `.planning/phases/06-edge-integration/06-01-SUMMARY.md`
</output>
