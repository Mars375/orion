# Redis configuration for ORION Edge Integration
# Add to /etc/redis/redis.conf on Pi 16GB (orion-core)
#
# This configuration enables secure remote access from edge devices
# (e.g., Pi 4 running orion-edge-agent) to the Redis instance on orion-core.

# =============================================================================
# NETWORK BINDING
# =============================================================================
# Bind to private network interface in addition to localhost.
# Replace 192.168.1.100 with the actual IP of orion-core on your LAN.
#
# SECURITY: Only bind to private/internal IPs, never to 0.0.0.0
bind 127.0.0.1 192.168.1.100

# Default port (keep unless required otherwise)
port 6379

# Protected mode requires authentication when binding to non-localhost
protected-mode yes

# =============================================================================
# AUTHENTICATION
# =============================================================================
# Option 1: Simple password (Redis 5.x compatible)
# Replace with a strong, randomly generated password
requirepass orion-edge-secret-changeme

# Option 2: ACL for granular control (Redis 6+ only, recommended)
# Uncomment and configure if using Redis 6+
#
# Create edge user with limited permissions:
#   - Can read/write to orion:edge:* keys only
#   - Has pubsub access for edge streams
#   - Cannot run dangerous commands (FLUSHALL, CONFIG, etc.)
#
# user orion-edge on >edge-password-changeme ~orion:edge:* +@read +@write +@pubsub -@dangerous

# =============================================================================
# CONNECTION LIMITS
# =============================================================================
# Maximum number of connected clients
maxclients 100

# Close idle connections after 5 minutes (300 seconds)
# Set to 0 to disable timeout
timeout 300

# TCP keepalive for detecting dead connections
tcp-keepalive 300

# =============================================================================
# MEMORY LIMITS
# =============================================================================
# Limit Redis memory to leave room for LLMs on Pi 16GB
# Adjust based on your workload and available RAM
maxmemory 512mb

# Eviction policy when maxmemory is reached
# allkeys-lru: Evict least recently used keys of any type
maxmemory-policy allkeys-lru

# =============================================================================
# PERSISTENCE (optional for edge telemetry)
# =============================================================================
# RDB snapshots (can be disabled for pure streaming use)
# save 900 1
# save 300 10
# save 60 10000

# AOF persistence (recommended for durability)
# appendonly yes
# appendfsync everysec

# =============================================================================
# LOGGING
# =============================================================================
# Log level: debug, verbose, notice, warning
loglevel notice

# Log file location (empty string = stdout)
# logfile /var/log/redis/redis-server.log

# =============================================================================
# SECURITY HARDENING
# =============================================================================
# Disable dangerous commands (rename to empty string)
# These are already restricted with ACL, but belt-and-suspenders
# rename-command FLUSHALL ""
# rename-command FLUSHDB ""
# rename-command CONFIG ""
# rename-command SHUTDOWN ""
# rename-command DEBUG ""

# =============================================================================
# STREAMS CONFIGURATION
# =============================================================================
# Maximum length for telemetry streams (auto-trimmed with MAXLEN ~)
# Configured in RedisClient.PublishTelemetry(), not here
# Default: 10000 entries per stream

# Consumer group settings are created by orion-edge-agent on startup
